<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/admin_dashboard_applicants.css" />
    <style>
      /* Styling for the modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
        z-index: 1;
      }
  
      .modal-content {
        background: white;
        padding: 20px;
        border: 1px solid #ccc;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      /* .details {
      width: 600px;
      height: 650px;
      border: 0;
    } */

    .viva {
      border: 0;
    }
    </style>
  </head>
  <body>
    <table class="user-list">
      <!-- <thead>
        <tr>
          <th><span>Applicants</span></th>
          <th><span>Created</span></th>
          <th class="text-center"><span>Status</span></th>
          <th><span>Email</span></th>
          <th>&nbsp;</th>
        </tr>
      </thead> -->
      <tbody>
        <% data.forEach(row => { %>
        <tr>
          <td>
            <img src="https://bootdey.com/img/Content/user_1.jpg" alt="" />
            <span class="user-link"><%= row.first_name %> <%= row.last_name %></span>
            <span class="user-subhead"><%= row.student_id %></span>
          </td>
          <%
          function formatDate(dateString) {
            // Create a JavaScript Date object from the database string
                const date = new Date(dateString);
          
                // Format the date as dd/mm/yy
                const day = date.getDate().toString().padStart(2, '0');
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const year = date.getFullYear().toString().slice(-2);
                return `${day}/${month}/${year}`;
              }
           %>
          <td><%= formatDate(row.date_applied) %></td>

          <td class="text-center">
            <span class="label label-default"><%= row.application_status %></span>
          </td>
          <td>
            <a href="#" class="mail-link" onclick="showPopup('<%= row.student_id%>')">View details</a>
            <!-- <a href="#" class="mail-link" data-student_id ='<%= row.student_id%>'>View details</a> -->
            <div id="popupModal" class="modal">
              <div class="modal-content">
                <iframe class="details" id="iframe" frameborder="0"></iframe>
                <button onclick="hidePopup()">Close</button>
              </div>
            </div>
          </td>
          <td style="width: 20%">
            <button class="accept-button" onclick="showVivaPage('<%= row.student_id%>')">Select</button>
            <button class="reject-button">Reject</button>
          </td>
        </tr>
        <!-- Add more rows as needed -->
        <% }); %>
      </tbody>
    </table>
    <script>
      // JavaScript to show the popup
    function showPopup(student_id) {
      const iframe = document.getElementById('iframe');
      iframe.src = `/details?student_id=${student_id}`;
      iframe.height = 650;
      iframe.width = 600;
      document.getElementById('popupModal').style.display = 'flex';
    }

    // JavaScript to hide the popup
    function hidePopup() {
      document.getElementById('popupModal').style.display = 'none';
    }

    function showVivaPage(student_id) {
      const iframe = document.getElementById('iframe');
      iframe.src = `/assign_viva?student_id=${student_id}`;
      iframe.height = 200;
      iframe.width = 500;
      document.getElementById('popupModal').style.display = 'flex';
    }
    </script>
  </body>
</html>
